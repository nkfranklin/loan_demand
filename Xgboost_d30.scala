package lius

import java.io.BufferedOutputStream

import ml.dmlc.xgboost4j.scala.spark.XGBoost
import org.apache.hadoop.conf.Configuration
import org.apache.hadoop.fs.{FileSystem, Path}
import org.apache.spark.sql.{Dataset, Row, SparkSession}
import org.apache.spark.ml.classification.{BinaryLogisticRegressionSummary, GBTClassifier, LogisticRegression, MultilayerPerceptronClassifier}
import org.apache.spark.ml.feature.{IndexToString, LabeledPoint, StringIndexer, VectorIndexer}
import org.apache.spark.ml.linalg.Vectors
import org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator
import org.apache.spark.mllib.evaluation.{BinaryClassificationMetrics, MulticlassMetrics}
import org.apache.spark.mllib.feature.ChiSqSelector

/**
  * Created by weigenchen on 2017/5/22.
  */
object Xgboost_d30 {
  def main(args: Array[String]): Unit = {
    if (args.length != 5) {
      println(
        "usage: [Xgboost_round] [Xgboost_nworkers] [Xgboost_max_depth] [Xgboost_min_child_weight]  [Xgboost_model_save_name]")
      sys.exit(1)
    }
    println("Xgboost round:"+args(0))
    println("Xgboost nworkers:"+args(1))
    println("Xgboost max_depth:"+args(2))
    println("Xgboost min_child_weight:"+args(3))
    println("Xgboost model save name:"+args(4))
    val spark = SparkSession
      .builder
      .appName("cy")
      .enableHiveSupport()
      .getOrCreate()
    val sc = spark.sparkContext
//    sc.setLogLevel("Error")
    import spark.implicits._
    import spark.sql
    val features=Array("reg_date",
      "creditlimit_used",
      "avg_creditlimit",
      "std_creditlimit",
      "max_creditlimit",
      "inst_ratio",
      "creditlimit_used_ratio",
      "guanjia_act_month_nb",
      "guanjia_act_df7_nb",
      "guanjia_act_df14_nb",
      "guanjia_act_df21_nb",
      "guanjia_act_df28_nb",
      "used_guanjia_early",
      "used_guanjia_sum",
      "import_bill_month_nb",
      "import_bill_df7_nb",
      "import_bill_df14_nb",
      "import_bill_df21_nb",
      "import_bill_df28_nb",
      "import_bill_early",
      "import_bill_sum",
      "rpd_act_month_nb",
      "rpd_act_df7_nb",
      "rpd_act_df14_nb",
      "rpd_act_df21_nb",
      "rpd_act_df28_nb",
      "rpd_active_early",
      "rpd_act_sum",
      "cash_ratio",
      "cardno_nb",
      "operator_verify_early",
      "bank_nb",
      "true_name_verify_early",
      "creditbill_verify_early",
      "zhifubao_verify_early",
      "info_verify_early",
      "bindcard_import_month_nb",
      "bindcard_import_df7_nb",
      "bindcard_import_df14_nb",
      "bindcard_import_df21_nb",
      "bindcard_import_df28_nb",
      "bindcard_import_early",
      "bindcard_import_sum",
      "zhengxin_month_nb",
      "zhengxin_df7_nb",
      "zhengxin_df14_nb",
      "zhengxin_df21_nb",
      "zhengxin_df28_nb",
      "zhengxin_early",
      "zhengxin_sum",
      "taobao_verify_early",
      "import_bill_month_nb",
      "import_bill_df7_nb",
      "import_bill_df14_nb",
      "import_bill_df21_nb",
      "import_bill_df28_nb",
      "import_bill_early",
      "import_bill_sum",
      "used_renpin_month_nb",
      "used_renpin_df7_nb",
      "used_renpin_df14_nb",
      "used_renpin_df21_nb",
      "used_renpin_df28_nb",
      "used_renpin_early",
      "used_renpin_sum",
      "contacts_verify_early",
      "housingfund_verify_month_nb",
      "housingfund_verify_df7_nb",
      "housingfund_verify_df14_nb",
      "housingfund_verify_df21_nb",
      "housingfund_verify_df28_nb",
      "housingfund_verify_early",
      "BP042_month_nb",
      "BP042_df7_nb",
      "BP042_df14_nb",
      "BP042_df21_nb",
      "BP042_df28_nb",
      "BP042_early_dt",
      "BP042_dt_num",
      "BP031_month_nb",
      "BP031_df7_nb",
      "BP031_df14_nb",
      "BP031_df21_nb",
      "BP031_df28_nb",
      "BP031_early_dt",
      "BP031_dt_num",
      "BP212_month_nb",
      "BP212_df7_nb",
      "BP212_df14_nb",
      "BP212_df21_nb",
      "BP212_df28_nb",
      "BP212_early_dt",
      "BP212_dt_num",
      "BP215_month_nb",
      "BP215_df7_nb",
      "BP215_df14_nb",
      "BP215_df21_nb",
      "BP215_df28_nb",
      "BP215_early_dt",
      "BP215_dt_num",
      "rpd_verify_2_month_nb",
      "rpd_verify_2_df7_nb",
      "rpd_verify_2_df14_nb",
      "rpd_verify_2_df21_nb",
      "rpd_verify_2_df28_nb",
      "rpd_verify_2_early_dt",
      "rpd_verify_2_dt_num",
      "BP017_month_nb",
      "BP017_df7_nb",
      "BP017_df14_nb",
      "BP017_df21_nb",
      "BP017_df28_nb",
      "BP017_early_dt",
      "BP017_dt_num",
      "BP123_month_nb",
      "BP123_df7_nb",
      "BP123_df14_nb",
      "BP123_df21_nb",
      "BP123_df28_nb",
      "BP123_early_dt",
      "BP123_dt_num",
      "E162_month_nb",
      "E162_df7_nb",
      "E162_df14_nb",
      "E162_df21_nb",
      "E162_df28_nb",
      "E162_early_dt",
      "E162_dt_num",
      "BP036_month_nb",
      "BP036_df7_nb",
      "BP036_df14_nb",
      "BP036_df21_nb",
      "BP036_df28_nb",
      "BP036_early_dt",
      "BP036_dt_num",
      "E286_month_nb",
      "E286_df7_nb",
      "E286_df14_nb",
      "E286_df21_nb",
      "E286_df28_nb",
      "E286_early_dt",
      "E286_dt_num",
      "BP110_3_month_nb",
      "BP110_3_df7_nb",
      "BP110_3_df14_nb",
      "BP110_3_df21_nb",
      "BP110_3_df28_nb",
      "BP110_3_early_dt",
      "BP110_3_dt_num",
      "BP109_month_nb",
      "BP109_df7_nb",
      "BP109_df14_nb",
      "BP109_df21_nb",
      "BP109_df28_nb",
      "BP109_early_dt",
      "BP109_dt_num",
      "rpd_verify_14_month_nb",
      "rpd_verify_14_df7_nb",
      "rpd_verify_14_df14_nb",
      "rpd_verify_14_df21_nb",
      "rpd_verify_14_df28_nb",
      "rpd_verify_14_early_dt",
      "rpd_verify_14_dt_num",
      "rpd_verify_7_month_nb",
      "rpd_verify_7_df7_nb",
      "rpd_verify_7_df14_nb",
      "rpd_verify_7_df21_nb",
      "rpd_verify_7_df28_nb",
      "rpd_verify_7_early_dt",
      "rpd_verify_7_dt_num",
      "BP021_month_nb",
      "BP021_df7_nb",
      "BP021_df14_nb",
      "BP021_df21_nb",
      "BP021_df28_nb",
      "BP021_early_dt",
      "BP021_dt_num",
      "rpd_index_btn_fail_month_nb",
      "rpd_index_btn_fail_df7_nb",
      "rpd_index_btn_fail_df14_nb",
      "rpd_index_btn_fail_df21_nb",
      "rpd_index_btn_fail_df28_nb",
      "rpd_index_btn_fail_early_dt",
      "rpd_index_btn_fail_dt_num",
      "BP178_month_nb",
      "BP178_df7_nb",
      "BP178_df14_nb",
      "BP178_df21_nb",
      "BP178_df28_nb",
      "BP178_early_dt",
      "BP178_dt_num",
      "BP022_month_nb",
      "BP022_df7_nb",
      "BP022_df14_nb",
      "BP022_df21_nb",
      "BP022_df28_nb",
      "BP022_early_dt",
      "BP022_dt_num",
      "rpd_index_btn_suc_month_nb",
      "rpd_index_btn_suc_df7_nb",
      "rpd_index_btn_suc_df14_nb",
      "rpd_index_btn_suc_df21_nb",
      "rpd_index_btn_suc_df28_nb",
      "rpd_index_btn_suc_early_dt",
      "rpd_index_btn_suc_dt_num",
      "BP110_1_month_nb",
      "BP110_1_df7_nb",
      "BP110_1_df14_nb",
      "BP110_1_df21_nb",
      "BP110_1_df28_nb",
      "BP110_1_early_dt",
      "BP110_1_dt_num",
      "BP119_month_nb",
      "BP119_df7_nb",
      "BP119_df14_nb",
      "BP119_df21_nb",
      "BP119_df28_nb",
      "BP119_early_dt",
      "BP119_dt_num",
      "E160_month_nb",
      "E160_df7_nb",
      "E160_df14_nb",
      "E160_df21_nb",
      "E160_df28_nb",
      "E160_early_dt",
      "E160_dt_num",
      "BP072_3_month_nb",
      "BP072_3_df7_nb",
      "BP072_3_df14_nb",
      "BP072_3_df21_nb",
      "BP072_3_df28_nb",
      "BP072_3_early_dt",
      "BP072_3_dt_num",
      "BP104_month_nb",
      "BP104_df7_nb",
      "BP104_df14_nb",
      "BP104_df21_nb",
      "BP104_df28_nb",
      "BP104_early_dt",
      "BP104_dt_num",
      "HP007_month_nb",
      "HP007_df7_nb",
      "HP007_df14_nb",
      "HP007_df21_nb",
      "HP007_df28_nb",
      "HP007_early_dt",
      "HP007_dt_num",
      "BP44_1_month_nb",
      "BP44_1_df7_nb",
      "BP44_1_df14_nb",
      "BP44_1_df21_nb",
      "BP44_1_df28_nb",
      "BP44_1_early_dt",
      "BP44_1_dt_num",
      "BP084_6_month_nb",
      "BP084_6_df7_nb",
      "BP084_6_df14_nb",
      "BP084_6_df21_nb",
      "BP084_6_df28_nb",
      "BP084_6_early_dt",
      "BP084_6_dt_num",
      "BP095_month_nb",
      "BP095_df7_nb",
      "BP095_df14_nb",
      "BP095_df21_nb",
      "BP095_df28_nb",
      "BP095_early_dt",
      "BP095_dt_num",
      "BP121_month_nb",
      "BP121_df7_nb",
      "BP121_df14_nb",
      "BP121_df21_nb",
      "BP121_df28_nb",
      "BP121_early_dt",
      "BP121_dt_num",
      "BP202_month_nb",
      "BP202_df7_nb",
      "BP202_df14_nb",
      "BP202_df21_nb",
      "BP202_df28_nb",
      "BP202_early_dt",
      "BP202_dt_num",
      "BP154_2_month_nb",
      "BP154_2_df7_nb",
      "BP154_2_df14_nb",
      "BP154_2_df21_nb",
      "BP154_2_df28_nb",
      "BP154_2_early_dt",
      "BP154_2_dt_num",
      "BP163_month_nb",
      "BP163_df7_nb",
      "BP163_df14_nb",
      "BP163_df21_nb",
      "BP163_df28_nb",
      "BP163_early_dt",
      "BP163_dt_num",
      "BP107_month_nb",
      "BP107_df7_nb",
      "BP107_df14_nb",
      "BP107_df21_nb",
      "BP107_df28_nb",
      "BP107_early_dt",
      "BP107_dt_num",
      "BP196_3_month_nb",
      "BP196_3_df7_nb",
      "BP196_3_df14_nb",
      "BP196_3_df21_nb",
      "BP196_3_df28_nb",
      "BP196_3_early_dt",
      "BP196_3_dt_num",
      "BP198_month_nb",
      "BP198_df7_nb",
      "BP198_df14_nb",
      "BP198_df21_nb",
      "BP198_df28_nb",
      "BP198_early_dt",
      "BP198_dt_num",
      "BP172_month_nb",
      "BP172_df7_nb",
      "BP172_df14_nb",
      "BP172_df21_nb",
      "BP172_df28_nb",
      "BP172_early_dt",
      "BP172_dt_num",
      "BP143_month_nb",
      "BP143_df7_nb",
      "BP143_df14_nb",
      "BP143_df21_nb",
      "BP143_df28_nb",
      "BP143_early_dt",
      "BP143_dt_num",
      "BP037_month_nb",
      "BP037_df7_nb",
      "BP037_df14_nb",
      "BP037_df21_nb",
      "BP037_df28_nb",
      "BP037_early_dt",
      "BP037_dt_num")
//    val max_data=sql(
//      """
//        |select
// |max(reg_date) reg_date,
// |max(creditlimit_used) creditlimit_used,
// |max(avg_creditlimit) avg_creditlimit,
// |max(std_creditlimit) std_creditlimit,
// |max(max_creditlimit) max_creditlimit,
// |max(inst_ratio) inst_ratio,
// |max(creditlimit_used_ratio) creditlimit_used_ratio,
// |max(guanjia_act_month_nb) guanjia_act_month_nb,
// |max(guanjia_act_df7_nb) guanjia_act_df7_nb,
// |max(guanjia_act_df14_nb) guanjia_act_df14_nb,
// |max(guanjia_act_df21_nb) guanjia_act_df21_nb,
// |max(guanjia_act_df28_nb) guanjia_act_df28_nb,
// |max(used_guanjia_early) used_guanjia_early,
// |max(used_guanjia_sum) used_guanjia_sum,
// |max(import_bill_month_nb) import_bill_month_nb,
// |max(import_bill_df7_nb) import_bill_df7_nb,
// |max(import_bill_df14_nb) import_bill_df14_nb,
// |max(import_bill_df21_nb) import_bill_df21_nb,
// |max(import_bill_df28_nb) import_bill_df28_nb,
// |max(import_bill_early) import_bill_early,
// |max(import_bill_sum) import_bill_sum,
// |max(rpd_act_month_nb) rpd_act_month_nb,
// |max(rpd_act_df7_nb) rpd_act_df7_nb,
// |max(rpd_act_df14_nb) rpd_act_df14_nb,
// |max(rpd_act_df21_nb) rpd_act_df21_nb,
// |max(rpd_act_df28_nb) rpd_act_df28_nb,
// |max(rpd_active_early) rpd_active_early,
// |max(rpd_act_sum) rpd_act_sum,
// |max(cash_ratio) cash_ratio,
// |max(cardno_nb) cardno_nb,
// |max(operator_verify_early) operator_verify_early,
// |max(bank_nb) bank_nb,
// |max(true_name_verify_early) true_name_verify_early,
// |max(creditbill_verify_early) creditbill_verify_early,
// |max(zhifubao_verify_early) zhifubao_verify_early,
// |max(info_verify_early) info_verify_early,
// |max(bindcard_import_month_nb) bindcard_import_month_nb,
// |max(bindcard_import_df7_nb) bindcard_import_df7_nb,
// |max(bindcard_import_df14_nb) bindcard_import_df14_nb,
// |max(bindcard_import_df21_nb) bindcard_import_df21_nb,
// |max(bindcard_import_df28_nb) bindcard_import_df28_nb,
// |max(bindcard_import_early) bindcard_import_early,
// |max(bindcard_import_sum) bindcard_import_sum,
// |max(zhengxin_month_nb) zhengxin_month_nb,
// |max(zhengxin_df7_nb) zhengxin_df7_nb,
// |max(zhengxin_df14_nb) zhengxin_df14_nb,
// |max(zhengxin_df21_nb) zhengxin_df21_nb,
// |max(zhengxin_df28_nb) zhengxin_df28_nb,
// |max(zhengxin_early) zhengxin_early,
// |max(zhengxin_sum) zhengxin_sum,
// |max(taobao_verify_early) taobao_verify_early,
// |max(import_bill_month_nb) import_bill_month_nb,
// |max(import_bill_df7_nb) import_bill_df7_nb,
// |max(import_bill_df14_nb) import_bill_df14_nb,
// |max(import_bill_df21_nb) import_bill_df21_nb,
// |max(import_bill_df28_nb) import_bill_df28_nb,
// |max(import_bill_early) import_bill_early,
// |max(import_bill_sum) import_bill_sum,
// |max(used_renpin_month_nb) used_renpin_month_nb,
// |max(used_renpin_df7_nb) used_renpin_df7_nb,
// |max(used_renpin_df14_nb) used_renpin_df14_nb,
// |max(used_renpin_df21_nb) used_renpin_df21_nb,
// |max(used_renpin_df28_nb) used_renpin_df28_nb,
// |max(used_renpin_early) used_renpin_early,
// |max(used_renpin_sum) used_renpin_sum,
// |max(contacts_verify_early) contacts_verify_early,
// |max(housingfund_verify_month_nb) housingfund_verify_month_nb,
// |max(housingfund_verify_df7_nb) housingfund_verify_df7_nb,
// |max(housingfund_verify_df14_nb) housingfund_verify_df14_nb,
// |max(housingfund_verify_df21_nb) housingfund_verify_df21_nb,
// |max(housingfund_verify_df28_nb) housingfund_verify_df28_nb,
// |max(housingfund_verify_early) housingfund_verify_early,
// |max(BP042_month_nb) BP042_month_nb,
// |max(BP042_df7_nb) BP042_df7_nb,
// |max(BP042_df14_nb) BP042_df14_nb,
// |max(BP042_df21_nb) BP042_df21_nb,
// |max(BP042_df28_nb) BP042_df28_nb,
// |max(BP042_early_dt) BP042_early_dt,
// |max(BP042_dt_num) BP042_dt_num,
// |max(BP031_month_nb) BP031_month_nb,
// |max(BP031_df7_nb) BP031_df7_nb,
// |max(BP031_df14_nb) BP031_df14_nb,
// |max(BP031_df21_nb) BP031_df21_nb,
// |max(BP031_df28_nb) BP031_df28_nb,
// |max(BP031_early_dt) BP031_early_dt,
// |max(BP031_dt_num) BP031_dt_num,
// |max(BP212_month_nb) BP212_month_nb,
// |max(BP212_df7_nb) BP212_df7_nb,
// |max(BP212_df14_nb) BP212_df14_nb,
// |max(BP212_df21_nb) BP212_df21_nb,
// |max(BP212_df28_nb) BP212_df28_nb,
// |max(BP212_early_dt) BP212_early_dt,
// |max(BP212_dt_num) BP212_dt_num,
// |max(BP215_month_nb) BP215_month_nb,
// |max(BP215_df7_nb) BP215_df7_nb,
// |max(BP215_df14_nb) BP215_df14_nb,
// |max(BP215_df21_nb) BP215_df21_nb,
// |max(BP215_df28_nb) BP215_df28_nb,
// |max(BP215_early_dt) BP215_early_dt,
// |max(BP215_dt_num) BP215_dt_num,
// |max(rpd_verify_2_month_nb) rpd_verify_2_month_nb,
// |max(rpd_verify_2_df7_nb) rpd_verify_2_df7_nb,
// |max(rpd_verify_2_df14_nb) rpd_verify_2_df14_nb,
// |max(rpd_verify_2_df21_nb) rpd_verify_2_df21_nb,
// |max(rpd_verify_2_df28_nb) rpd_verify_2_df28_nb,
// |max(rpd_verify_2_early_dt) rpd_verify_2_early_dt,
// |max(rpd_verify_2_dt_num) rpd_verify_2_dt_num,
// |max(BP017_month_nb) BP017_month_nb,
// |max(BP017_df7_nb) BP017_df7_nb,
// |max(BP017_df14_nb) BP017_df14_nb,
// |max(BP017_df21_nb) BP017_df21_nb,
// |max(BP017_df28_nb) BP017_df28_nb,
// |max(BP017_early_dt) BP017_early_dt,
// |max(BP017_dt_num) BP017_dt_num,
// |max(BP123_month_nb) BP123_month_nb,
// |max(BP123_df7_nb) BP123_df7_nb,
// |max(BP123_df14_nb) BP123_df14_nb,
// |max(BP123_df21_nb) BP123_df21_nb,
// |max(BP123_df28_nb) BP123_df28_nb,
// |max(BP123_early_dt) BP123_early_dt,
// |max(BP123_dt_num) BP123_dt_num,
// |max(E162_month_nb) E162_month_nb,
// |max(E162_df7_nb) E162_df7_nb,
// |max(E162_df14_nb) E162_df14_nb,
// |max(E162_df21_nb) E162_df21_nb,
// |max(E162_df28_nb) E162_df28_nb,
// |max(E162_early_dt) E162_early_dt,
// |max(E162_dt_num) E162_dt_num,
// |max(BP036_month_nb) BP036_month_nb,
// |max(BP036_df7_nb) BP036_df7_nb,
// |max(BP036_df14_nb) BP036_df14_nb,
// |max(BP036_df21_nb) BP036_df21_nb,
// |max(BP036_df28_nb) BP036_df28_nb,
// |max(BP036_early_dt) BP036_early_dt,
// |max(BP036_dt_num) BP036_dt_num,
// |max(E286_month_nb) E286_month_nb,
// |max(E286_df7_nb) E286_df7_nb,
// |max(E286_df14_nb) E286_df14_nb,
// |max(E286_df21_nb) E286_df21_nb,
// |max(E286_df28_nb) E286_df28_nb,
// |max(E286_early_dt) E286_early_dt,
// |max(E286_dt_num) E286_dt_num,
// |max(BP110_3_month_nb) BP110_3_month_nb,
// |max(BP110_3_df7_nb) BP110_3_df7_nb,
// |max(BP110_3_df14_nb) BP110_3_df14_nb,
// |max(BP110_3_df21_nb) BP110_3_df21_nb,
// |max(BP110_3_df28_nb) BP110_3_df28_nb,
// |max(BP110_3_early_dt) BP110_3_early_dt,
// |max(BP110_3_dt_num) BP110_3_dt_num,
// |max(BP109_month_nb) BP109_month_nb,
// |max(BP109_df7_nb) BP109_df7_nb,
// |max(BP109_df14_nb) BP109_df14_nb,
// |max(BP109_df21_nb) BP109_df21_nb,
// |max(BP109_df28_nb) BP109_df28_nb,
// |max(BP109_early_dt) BP109_early_dt,
// |max(BP109_dt_num) BP109_dt_num,
// |max(rpd_verify_14_month_nb) rpd_verify_14_month_nb,
// |max(rpd_verify_14_df7_nb) rpd_verify_14_df7_nb,
// |max(rpd_verify_14_df14_nb) rpd_verify_14_df14_nb,
// |max(rpd_verify_14_df21_nb) rpd_verify_14_df21_nb,
// |max(rpd_verify_14_df28_nb) rpd_verify_14_df28_nb,
// |max(rpd_verify_14_early_dt) rpd_verify_14_early_dt,
// |max(rpd_verify_14_dt_num) rpd_verify_14_dt_num,
// |max(rpd_verify_7_month_nb) rpd_verify_7_month_nb,
// |max(rpd_verify_7_df7_nb) rpd_verify_7_df7_nb,
// |max(rpd_verify_7_df14_nb) rpd_verify_7_df14_nb,
// |max(rpd_verify_7_df21_nb) rpd_verify_7_df21_nb,
// |max(rpd_verify_7_df28_nb) rpd_verify_7_df28_nb,
// |max(rpd_verify_7_early_dt) rpd_verify_7_early_dt,
// |max(rpd_verify_7_dt_num) rpd_verify_7_dt_num,
// |max(BP021_month_nb) BP021_month_nb,
// |max(BP021_df7_nb) BP021_df7_nb,
// |max(BP021_df14_nb) BP021_df14_nb,
// |max(BP021_df21_nb) BP021_df21_nb,
// |max(BP021_df28_nb) BP021_df28_nb,
// |max(BP021_early_dt) BP021_early_dt,
// |max(BP021_dt_num) BP021_dt_num,
// |max(rpd_index_btn_fail_month_nb) rpd_index_btn_fail_month_nb,
// |max(rpd_index_btn_fail_df7_nb) rpd_index_btn_fail_df7_nb,
// |max(rpd_index_btn_fail_df14_nb) rpd_index_btn_fail_df14_nb,
// |max(rpd_index_btn_fail_df21_nb) rpd_index_btn_fail_df21_nb,
// |max(rpd_index_btn_fail_df28_nb) rpd_index_btn_fail_df28_nb,
// |max(rpd_index_btn_fail_early_dt) rpd_index_btn_fail_early_dt,
// |max(rpd_index_btn_fail_dt_num) rpd_index_btn_fail_dt_num,
// |max(BP178_month_nb) BP178_month_nb,
// |max(BP178_df7_nb) BP178_df7_nb,
// |max(BP178_df14_nb) BP178_df14_nb,
// |max(BP178_df21_nb) BP178_df21_nb,
// |max(BP178_df28_nb) BP178_df28_nb,
// |max(BP178_early_dt) BP178_early_dt,
// |max(BP178_dt_num) BP178_dt_num,
// |max(BP022_month_nb) BP022_month_nb,
// |max(BP022_df7_nb) BP022_df7_nb,
// |max(BP022_df14_nb) BP022_df14_nb,
// |max(BP022_df21_nb) BP022_df21_nb,
// |max(BP022_df28_nb) BP022_df28_nb,
// |max(BP022_early_dt) BP022_early_dt,
// |max(BP022_dt_num) BP022_dt_num,
// |max(rpd_index_btn_suc_month_nb) rpd_index_btn_suc_month_nb,
// |max(rpd_index_btn_suc_df7_nb) rpd_index_btn_suc_df7_nb,
// |max(rpd_index_btn_suc_df14_nb) rpd_index_btn_suc_df14_nb,
// |max(rpd_index_btn_suc_df21_nb) rpd_index_btn_suc_df21_nb,
// |max(rpd_index_btn_suc_df28_nb) rpd_index_btn_suc_df28_nb,
// |max(rpd_index_btn_suc_early_dt) rpd_index_btn_suc_early_dt,
// |max(rpd_index_btn_suc_dt_num) rpd_index_btn_suc_dt_num,
// |max(BP110_1_month_nb) BP110_1_month_nb,
// |max(BP110_1_df7_nb) BP110_1_df7_nb,
// |max(BP110_1_df14_nb) BP110_1_df14_nb,
// |max(BP110_1_df21_nb) BP110_1_df21_nb,
// |max(BP110_1_df28_nb) BP110_1_df28_nb,
// |max(BP110_1_early_dt) BP110_1_early_dt,
// |max(BP110_1_dt_num) BP110_1_dt_num,
// |max(BP119_month_nb) BP119_month_nb,
// |max(BP119_df7_nb) BP119_df7_nb,
// |max(BP119_df14_nb) BP119_df14_nb,
// |max(BP119_df21_nb) BP119_df21_nb,
// |max(BP119_df28_nb) BP119_df28_nb,
// |max(BP119_early_dt) BP119_early_dt,
// |max(BP119_dt_num) BP119_dt_num,
// |max(E160_month_nb) E160_month_nb,
// |max(E160_df7_nb) E160_df7_nb,
// |max(E160_df14_nb) E160_df14_nb,
// |max(E160_df21_nb) E160_df21_nb,
// |max(E160_df28_nb) E160_df28_nb,
// |max(E160_early_dt) E160_early_dt,
// |max(E160_dt_num) E160_dt_num,
// |max(BP072_3_month_nb) BP072_3_month_nb,
// |max(BP072_3_df7_nb) BP072_3_df7_nb,
// |max(BP072_3_df14_nb) BP072_3_df14_nb,
// |max(BP072_3_df21_nb) BP072_3_df21_nb,
// |max(BP072_3_df28_nb) BP072_3_df28_nb,
// |max(BP072_3_early_dt) BP072_3_early_dt,
// |max(BP072_3_dt_num) BP072_3_dt_num,
// |max(BP104_month_nb) BP104_month_nb,
// |max(BP104_df7_nb) BP104_df7_nb,
// |max(BP104_df14_nb) BP104_df14_nb,
// |max(BP104_df21_nb) BP104_df21_nb,
// |max(BP104_df28_nb) BP104_df28_nb,
// |max(BP104_early_dt) BP104_early_dt,
// |max(BP104_dt_num) BP104_dt_num,
// |max(HP007_month_nb) HP007_month_nb,
// |max(HP007_df7_nb) HP007_df7_nb,
// |max(HP007_df14_nb) HP007_df14_nb,
// |max(HP007_df21_nb) HP007_df21_nb,
// |max(HP007_df28_nb) HP007_df28_nb,
// |max(HP007_early_dt) HP007_early_dt,
// |max(HP007_dt_num) HP007_dt_num,
// |max(BP44_1_month_nb) BP44_1_month_nb,
// |max(BP44_1_df7_nb) BP44_1_df7_nb,
// |max(BP44_1_df14_nb) BP44_1_df14_nb,
// |max(BP44_1_df21_nb) BP44_1_df21_nb,
// |max(BP44_1_df28_nb) BP44_1_df28_nb,
// |max(BP44_1_early_dt) BP44_1_early_dt,
// |max(BP44_1_dt_num) BP44_1_dt_num,
// |max(BP084_6_month_nb) BP084_6_month_nb,
// |max(BP084_6_df7_nb) BP084_6_df7_nb,
// |max(BP084_6_df14_nb) BP084_6_df14_nb,
// |max(BP084_6_df21_nb) BP084_6_df21_nb,
// |max(BP084_6_df28_nb) BP084_6_df28_nb,
// |max(BP084_6_early_dt) BP084_6_early_dt,
// |max(BP084_6_dt_num) BP084_6_dt_num,
// |max(BP095_month_nb) BP095_month_nb,
// |max(BP095_df7_nb) BP095_df7_nb,
// |max(BP095_df14_nb) BP095_df14_nb,
// |max(BP095_df21_nb) BP095_df21_nb,
// |max(BP095_df28_nb) BP095_df28_nb,
// |max(BP095_early_dt) BP095_early_dt,
// |max(BP095_dt_num) BP095_dt_num,
// |max(BP121_month_nb) BP121_month_nb,
// |max(BP121_df7_nb) BP121_df7_nb,
// |max(BP121_df14_nb) BP121_df14_nb,
// |max(BP121_df21_nb) BP121_df21_nb,
// |max(BP121_df28_nb) BP121_df28_nb,
// |max(BP121_early_dt) BP121_early_dt,
// |max(BP121_dt_num) BP121_dt_num,
// |max(BP202_month_nb) BP202_month_nb,
// |max(BP202_df7_nb) BP202_df7_nb,
// |max(BP202_df14_nb) BP202_df14_nb,
// |max(BP202_df21_nb) BP202_df21_nb,
// |max(BP202_df28_nb) BP202_df28_nb,
// |max(BP202_early_dt) BP202_early_dt,
// |max(BP202_dt_num) BP202_dt_num,
// |max(BP154_2_month_nb) BP154_2_month_nb,
// |max(BP154_2_df7_nb) BP154_2_df7_nb,
// |max(BP154_2_df14_nb) BP154_2_df14_nb,
// |max(BP154_2_df21_nb) BP154_2_df21_nb,
// |max(BP154_2_df28_nb) BP154_2_df28_nb,
// |max(BP154_2_early_dt) BP154_2_early_dt,
// |max(BP154_2_dt_num) BP154_2_dt_num,
// |max(BP163_month_nb) BP163_month_nb,
// |max(BP163_df7_nb) BP163_df7_nb,
// |max(BP163_df14_nb) BP163_df14_nb,
// |max(BP163_df21_nb) BP163_df21_nb,
// |max(BP163_df28_nb) BP163_df28_nb,
// |max(BP163_early_dt) BP163_early_dt,
// |max(BP163_dt_num) BP163_dt_num,
// |max(BP107_month_nb) BP107_month_nb,
// |max(BP107_df7_nb) BP107_df7_nb,
// |max(BP107_df14_nb) BP107_df14_nb,
// |max(BP107_df21_nb) BP107_df21_nb,
// |max(BP107_df28_nb) BP107_df28_nb,
// |max(BP107_early_dt) BP107_early_dt,
// |max(BP107_dt_num) BP107_dt_num,
// |max(BP196_3_month_nb) BP196_3_month_nb,
// |max(BP196_3_df7_nb) BP196_3_df7_nb,
// |max(BP196_3_df14_nb) BP196_3_df14_nb,
// |max(BP196_3_df21_nb) BP196_3_df21_nb,
// |max(BP196_3_df28_nb) BP196_3_df28_nb,
// |max(BP196_3_early_dt) BP196_3_early_dt,
// |max(BP196_3_dt_num) BP196_3_dt_num,
// |max(BP198_month_nb) BP198_month_nb,
// |max(BP198_df7_nb) BP198_df7_nb,
// |max(BP198_df14_nb) BP198_df14_nb,
// |max(BP198_df21_nb) BP198_df21_nb,
// |max(BP198_df28_nb) BP198_df28_nb,
// |max(BP198_early_dt) BP198_early_dt,
// |max(BP198_dt_num) BP198_dt_num,
// |max(BP172_month_nb) BP172_month_nb,
// |max(BP172_df7_nb) BP172_df7_nb,
// |max(BP172_df14_nb) BP172_df14_nb,
// |max(BP172_df21_nb) BP172_df21_nb,
// |max(BP172_df28_nb) BP172_df28_nb,
// |max(BP172_early_dt) BP172_early_dt,
// |max(BP172_dt_num) BP172_dt_num,
// |max(BP143_month_nb) BP143_month_nb,
// |max(BP143_df7_nb) BP143_df7_nb,
// |max(BP143_df14_nb) BP143_df14_nb,
// |max(BP143_df21_nb) BP143_df21_nb,
// |max(BP143_df28_nb) BP143_df28_nb,
// |max(BP143_early_dt) BP143_early_dt,
// |max(BP143_dt_num) BP143_dt_num,
// |max(BP037_month_nb) BP037_month_nb,
// |max(BP037_df7_nb) BP037_df7_nb,
// |max(BP037_df14_nb) BP037_df14_nb,
// |max(BP037_df21_nb) BP037_df21_nb,
// |max(BP037_df28_nb) BP037_df28_nb,
// |max(BP037_early_dt) BP037_early_dt,
// |max(BP037_dt_num) BP037_dt_num
//        |from vdm_fin.cwg_event_0401_day30_0612_new
//      """.stripMargin).first()
//    var max_map:Map[String,Float] = Map()
//    features.foreach(f=>max_map+=(f->max_data.getAs(f).toString.toDouble.formatted("%.3f").toFloat))
//    val max_string=max_map.map(f=>f._1+":"+f._2).toList.mkString(",")
////    println("max:"+max_string)
//
//
//    val max_path = new Path("hdfs://nameservice1/user/chenweigen/max_info_30day_new.txt")
//    val conf = new Configuration(sc.hadoopConfiguration)
//
//    val max_fs = max_path.getFileSystem(conf)
//    if (max_fs.exists(max_path))
//      max_fs.delete(max_path, true)
//    val max_out_stream = new BufferedOutputStream(max_fs.create(max_path))
//    max_out_stream.write(max_string.getBytes("UTF-8"))
//    max_out_stream.flush()
//    max_out_stream.close()
//    max_fs.close()

//    val min_data=sql(
//      """
//        select
//       |min(reg_date) reg_date,
//       |min(creditlimit_used) creditlimit_used,
//       |min(avg_creditlimit) avg_creditlimit,
//       |min(std_creditlimit) std_creditlimit,
//       |min(max_creditlimit) max_creditlimit,
//       |min(inst_ratio) inst_ratio,
//       |min(creditlimit_used_ratio) creditlimit_used_ratio,
//       |min(guanjia_act_month_nb) guanjia_act_month_nb,
//       |min(guanjia_act_df7_nb) guanjia_act_df7_nb,
//       |min(guanjia_act_df14_nb) guanjia_act_df14_nb,
//       |min(guanjia_act_df21_nb) guanjia_act_df21_nb,
//       |min(guanjia_act_df28_nb) guanjia_act_df28_nb,
//       |min(used_guanjia_early) used_guanjia_early,
//       |min(used_guanjia_sum) used_guanjia_sum,
//       |min(import_bill_month_nb) import_bill_month_nb,
//       |min(import_bill_df7_nb) import_bill_df7_nb,
//       |min(import_bill_df14_nb) import_bill_df14_nb,
//       |min(import_bill_df21_nb) import_bill_df21_nb,
//       |min(import_bill_df28_nb) import_bill_df28_nb,
//       |min(import_bill_early) import_bill_early,
//       |min(import_bill_sum) import_bill_sum,
//       |min(rpd_act_month_nb) rpd_act_month_nb,
//       |min(rpd_act_df7_nb) rpd_act_df7_nb,
//       |min(rpd_act_df14_nb) rpd_act_df14_nb,
//       |min(rpd_act_df21_nb) rpd_act_df21_nb,
//       |min(rpd_act_df28_nb) rpd_act_df28_nb,
//       |min(rpd_active_early) rpd_active_early,
//       |min(rpd_act_sum) rpd_act_sum,
//       |min(cash_ratio) cash_ratio,
//       |min(cardno_nb) cardno_nb,
//       |min(operator_verify_early) operator_verify_early,
//       |min(bank_nb) bank_nb,
//       |min(true_name_verify_early) true_name_verify_early,
//       |min(creditbill_verify_early) creditbill_verify_early,
//       |min(zhifubao_verify_early) zhifubao_verify_early,
//       |min(info_verify_early) info_verify_early,
//       |min(bindcard_import_month_nb) bindcard_import_month_nb,
//       |min(bindcard_import_df7_nb) bindcard_import_df7_nb,
//       |min(bindcard_import_df14_nb) bindcard_import_df14_nb,
//       |min(bindcard_import_df21_nb) bindcard_import_df21_nb,
//       |min(bindcard_import_df28_nb) bindcard_import_df28_nb,
//       |min(bindcard_import_early) bindcard_import_early,
//       |min(bindcard_import_sum) bindcard_import_sum,
//       |min(zhengxin_month_nb) zhengxin_month_nb,
//       |min(zhengxin_df7_nb) zhengxin_df7_nb,
//       |min(zhengxin_df14_nb) zhengxin_df14_nb,
//       |min(zhengxin_df21_nb) zhengxin_df21_nb,
//       |min(zhengxin_df28_nb) zhengxin_df28_nb,
//       |min(zhengxin_early) zhengxin_early,
//       |min(zhengxin_sum) zhengxin_sum,
//       |min(taobao_verify_early) taobao_verify_early,
//       |min(import_bill_month_nb) import_bill_month_nb,
//       |min(import_bill_df7_nb) import_bill_df7_nb,
//       |min(import_bill_df14_nb) import_bill_df14_nb,
//       |min(import_bill_df21_nb) import_bill_df21_nb,
//       |min(import_bill_df28_nb) import_bill_df28_nb,
//       |min(import_bill_early) import_bill_early,
//       |min(import_bill_sum) import_bill_sum,
//       |min(used_renpin_month_nb) used_renpin_month_nb,
//       |min(used_renpin_df7_nb) used_renpin_df7_nb,
//       |min(used_renpin_df14_nb) used_renpin_df14_nb,
//       |min(used_renpin_df21_nb) used_renpin_df21_nb,
//       |min(used_renpin_df28_nb) used_renpin_df28_nb,
//       |min(used_renpin_early) used_renpin_early,
//       |min(used_renpin_sum) used_renpin_sum,
//       |min(contacts_verify_early) contacts_verify_early,
//       |min(housingfund_verify_month_nb) housingfund_verify_month_nb,
//       |min(housingfund_verify_df7_nb) housingfund_verify_df7_nb,
//       |min(housingfund_verify_df14_nb) housingfund_verify_df14_nb,
//       |min(housingfund_verify_df21_nb) housingfund_verify_df21_nb,
//       |min(housingfund_verify_df28_nb) housingfund_verify_df28_nb,
//       |min(housingfund_verify_early) housingfund_verify_early,
//       |min(BP042_month_nb) BP042_month_nb,
//       |min(BP042_df7_nb) BP042_df7_nb,
//       |min(BP042_df14_nb) BP042_df14_nb,
//       |min(BP042_df21_nb) BP042_df21_nb,
//       |min(BP042_df28_nb) BP042_df28_nb,
//       |min(BP042_early_dt) BP042_early_dt,
//       |min(BP042_dt_num) BP042_dt_num,
//       |min(BP031_month_nb) BP031_month_nb,
//       |min(BP031_df7_nb) BP031_df7_nb,
//       |min(BP031_df14_nb) BP031_df14_nb,
//       |min(BP031_df21_nb) BP031_df21_nb,
//       |min(BP031_df28_nb) BP031_df28_nb,
//       |min(BP031_early_dt) BP031_early_dt,
//       |min(BP031_dt_num) BP031_dt_num,
//       |min(BP212_month_nb) BP212_month_nb,
//       |min(BP212_df7_nb) BP212_df7_nb,
//       |min(BP212_df14_nb) BP212_df14_nb,
//       |min(BP212_df21_nb) BP212_df21_nb,
//       |min(BP212_df28_nb) BP212_df28_nb,
//       |min(BP212_early_dt) BP212_early_dt,
//       |min(BP212_dt_num) BP212_dt_num,
//       |min(BP215_month_nb) BP215_month_nb,
//       |min(BP215_df7_nb) BP215_df7_nb,
//       |min(BP215_df14_nb) BP215_df14_nb,
//       |min(BP215_df21_nb) BP215_df21_nb,
//       |min(BP215_df28_nb) BP215_df28_nb,
//       |min(BP215_early_dt) BP215_early_dt,
//       |min(BP215_dt_num) BP215_dt_num,
//       |min(rpd_verify_2_month_nb) rpd_verify_2_month_nb,
//       |min(rpd_verify_2_df7_nb) rpd_verify_2_df7_nb,
//       |min(rpd_verify_2_df14_nb) rpd_verify_2_df14_nb,
//       |min(rpd_verify_2_df21_nb) rpd_verify_2_df21_nb,
//       |min(rpd_verify_2_df28_nb) rpd_verify_2_df28_nb,
//       |min(rpd_verify_2_early_dt) rpd_verify_2_early_dt,
//       |min(rpd_verify_2_dt_num) rpd_verify_2_dt_num,
//       |min(BP017_month_nb) BP017_month_nb,
//       |min(BP017_df7_nb) BP017_df7_nb,
//       |min(BP017_df14_nb) BP017_df14_nb,
//       |min(BP017_df21_nb) BP017_df21_nb,
//       |min(BP017_df28_nb) BP017_df28_nb,
//       |min(BP017_early_dt) BP017_early_dt,
//       |min(BP017_dt_num) BP017_dt_num,
//       |min(BP123_month_nb) BP123_month_nb,
//       |min(BP123_df7_nb) BP123_df7_nb,
//       |min(BP123_df14_nb) BP123_df14_nb,
//       |min(BP123_df21_nb) BP123_df21_nb,
//       |min(BP123_df28_nb) BP123_df28_nb,
//       |min(BP123_early_dt) BP123_early_dt,
//       |min(BP123_dt_num) BP123_dt_num,
//       |min(E162_month_nb) E162_month_nb,
//       |min(E162_df7_nb) E162_df7_nb,
//       |min(E162_df14_nb) E162_df14_nb,
//       |min(E162_df21_nb) E162_df21_nb,
//       |min(E162_df28_nb) E162_df28_nb,
//       |min(E162_early_dt) E162_early_dt,
//       |min(E162_dt_num) E162_dt_num,
//       |min(BP036_month_nb) BP036_month_nb,
//       |min(BP036_df7_nb) BP036_df7_nb,
//       |min(BP036_df14_nb) BP036_df14_nb,
//       |min(BP036_df21_nb) BP036_df21_nb,
//       |min(BP036_df28_nb) BP036_df28_nb,
//       |min(BP036_early_dt) BP036_early_dt,
//       |min(BP036_dt_num) BP036_dt_num,
//       |min(E286_month_nb) E286_month_nb,
//       |min(E286_df7_nb) E286_df7_nb,
//       |min(E286_df14_nb) E286_df14_nb,
//       |min(E286_df21_nb) E286_df21_nb,
//       |min(E286_df28_nb) E286_df28_nb,
//       |min(E286_early_dt) E286_early_dt,
//       |min(E286_dt_num) E286_dt_num,
//       |min(BP110_3_month_nb) BP110_3_month_nb,
//       |min(BP110_3_df7_nb) BP110_3_df7_nb,
//       |min(BP110_3_df14_nb) BP110_3_df14_nb,
//       |min(BP110_3_df21_nb) BP110_3_df21_nb,
//       |min(BP110_3_df28_nb) BP110_3_df28_nb,
//       |min(BP110_3_early_dt) BP110_3_early_dt,
//       |min(BP110_3_dt_num) BP110_3_dt_num,
//       |min(BP109_month_nb) BP109_month_nb,
//       |min(BP109_df7_nb) BP109_df7_nb,
//       |min(BP109_df14_nb) BP109_df14_nb,
//       |min(BP109_df21_nb) BP109_df21_nb,
//       |min(BP109_df28_nb) BP109_df28_nb,
//       |min(BP109_early_dt) BP109_early_dt,
//       |min(BP109_dt_num) BP109_dt_num,
//       |min(rpd_verify_14_month_nb) rpd_verify_14_month_nb,
//       |min(rpd_verify_14_df7_nb) rpd_verify_14_df7_nb,
//       |min(rpd_verify_14_df14_nb) rpd_verify_14_df14_nb,
//       |min(rpd_verify_14_df21_nb) rpd_verify_14_df21_nb,
//       |min(rpd_verify_14_df28_nb) rpd_verify_14_df28_nb,
//       |min(rpd_verify_14_early_dt) rpd_verify_14_early_dt,
//       |min(rpd_verify_14_dt_num) rpd_verify_14_dt_num,
//       |min(rpd_verify_7_month_nb) rpd_verify_7_month_nb,
//       |min(rpd_verify_7_df7_nb) rpd_verify_7_df7_nb,
//       |min(rpd_verify_7_df14_nb) rpd_verify_7_df14_nb,
//       |min(rpd_verify_7_df21_nb) rpd_verify_7_df21_nb,
//       |min(rpd_verify_7_df28_nb) rpd_verify_7_df28_nb,
//       |min(rpd_verify_7_early_dt) rpd_verify_7_early_dt,
//       |min(rpd_verify_7_dt_num) rpd_verify_7_dt_num,
//       |min(BP021_month_nb) BP021_month_nb,
//       |min(BP021_df7_nb) BP021_df7_nb,
//       |min(BP021_df14_nb) BP021_df14_nb,
//       |min(BP021_df21_nb) BP021_df21_nb,
//       |min(BP021_df28_nb) BP021_df28_nb,
//       |min(BP021_early_dt) BP021_early_dt,
//       |min(BP021_dt_num) BP021_dt_num,
//       |min(rpd_index_btn_fail_month_nb) rpd_index_btn_fail_month_nb,
//       |min(rpd_index_btn_fail_df7_nb) rpd_index_btn_fail_df7_nb,
//       |min(rpd_index_btn_fail_df14_nb) rpd_index_btn_fail_df14_nb,
//       |min(rpd_index_btn_fail_df21_nb) rpd_index_btn_fail_df21_nb,
//       |min(rpd_index_btn_fail_df28_nb) rpd_index_btn_fail_df28_nb,
//       |min(rpd_index_btn_fail_early_dt) rpd_index_btn_fail_early_dt,
//       |min(rpd_index_btn_fail_dt_num) rpd_index_btn_fail_dt_num,
//       |min(BP178_month_nb) BP178_month_nb,
//       |min(BP178_df7_nb) BP178_df7_nb,
//       |min(BP178_df14_nb) BP178_df14_nb,
//       |min(BP178_df21_nb) BP178_df21_nb,
//       |min(BP178_df28_nb) BP178_df28_nb,
//       |min(BP178_early_dt) BP178_early_dt,
//       |min(BP178_dt_num) BP178_dt_num,
//       |min(BP022_month_nb) BP022_month_nb,
//       |min(BP022_df7_nb) BP022_df7_nb,
//       |min(BP022_df14_nb) BP022_df14_nb,
//       |min(BP022_df21_nb) BP022_df21_nb,
//       |min(BP022_df28_nb) BP022_df28_nb,
//       |min(BP022_early_dt) BP022_early_dt,
//       |min(BP022_dt_num) BP022_dt_num,
//       |min(rpd_index_btn_suc_month_nb) rpd_index_btn_suc_month_nb,
//       |min(rpd_index_btn_suc_df7_nb) rpd_index_btn_suc_df7_nb,
//       |min(rpd_index_btn_suc_df14_nb) rpd_index_btn_suc_df14_nb,
//       |min(rpd_index_btn_suc_df21_nb) rpd_index_btn_suc_df21_nb,
//       |min(rpd_index_btn_suc_df28_nb) rpd_index_btn_suc_df28_nb,
//       |min(rpd_index_btn_suc_early_dt) rpd_index_btn_suc_early_dt,
//       |min(rpd_index_btn_suc_dt_num) rpd_index_btn_suc_dt_num,
//       |min(BP110_1_month_nb) BP110_1_month_nb,
//       |min(BP110_1_df7_nb) BP110_1_df7_nb,
//       |min(BP110_1_df14_nb) BP110_1_df14_nb,
//       |min(BP110_1_df21_nb) BP110_1_df21_nb,
//       |min(BP110_1_df28_nb) BP110_1_df28_nb,
//       |min(BP110_1_early_dt) BP110_1_early_dt,
//       |min(BP110_1_dt_num) BP110_1_dt_num,
//       |min(BP119_month_nb) BP119_month_nb,
//       |min(BP119_df7_nb) BP119_df7_nb,
//       |min(BP119_df14_nb) BP119_df14_nb,
//       |min(BP119_df21_nb) BP119_df21_nb,
//       |min(BP119_df28_nb) BP119_df28_nb,
//       |min(BP119_early_dt) BP119_early_dt,
//       |min(BP119_dt_num) BP119_dt_num,
//       |min(E160_month_nb) E160_month_nb,
//       |min(E160_df7_nb) E160_df7_nb,
//       |min(E160_df14_nb) E160_df14_nb,
//       |min(E160_df21_nb) E160_df21_nb,
//       |min(E160_df28_nb) E160_df28_nb,
//       |min(E160_early_dt) E160_early_dt,
//       |min(E160_dt_num) E160_dt_num,
//       |min(BP072_3_month_nb) BP072_3_month_nb,
//       |min(BP072_3_df7_nb) BP072_3_df7_nb,
//       |min(BP072_3_df14_nb) BP072_3_df14_nb,
//       |min(BP072_3_df21_nb) BP072_3_df21_nb,
//       |min(BP072_3_df28_nb) BP072_3_df28_nb,
//       |min(BP072_3_early_dt) BP072_3_early_dt,
//       |min(BP072_3_dt_num) BP072_3_dt_num,
//       |min(BP104_month_nb) BP104_month_nb,
//       |min(BP104_df7_nb) BP104_df7_nb,
//       |min(BP104_df14_nb) BP104_df14_nb,
//       |min(BP104_df21_nb) BP104_df21_nb,
//       |min(BP104_df28_nb) BP104_df28_nb,
//       |min(BP104_early_dt) BP104_early_dt,
//       |min(BP104_dt_num) BP104_dt_num,
//       |min(HP007_month_nb) HP007_month_nb,
//       |min(HP007_df7_nb) HP007_df7_nb,
//       |min(HP007_df14_nb) HP007_df14_nb,
//       |min(HP007_df21_nb) HP007_df21_nb,
//       |min(HP007_df28_nb) HP007_df28_nb,
//       |min(HP007_early_dt) HP007_early_dt,
//       |min(HP007_dt_num) HP007_dt_num,
//       |min(BP44_1_month_nb) BP44_1_month_nb,
//       |min(BP44_1_df7_nb) BP44_1_df7_nb,
//       |min(BP44_1_df14_nb) BP44_1_df14_nb,
//       |min(BP44_1_df21_nb) BP44_1_df21_nb,
//       |min(BP44_1_df28_nb) BP44_1_df28_nb,
//       |min(BP44_1_early_dt) BP44_1_early_dt,
//       |min(BP44_1_dt_num) BP44_1_dt_num,
//       |min(BP084_6_month_nb) BP084_6_month_nb,
//       |min(BP084_6_df7_nb) BP084_6_df7_nb,
//       |min(BP084_6_df14_nb) BP084_6_df14_nb,
//       |min(BP084_6_df21_nb) BP084_6_df21_nb,
//       |min(BP084_6_df28_nb) BP084_6_df28_nb,
//       |min(BP084_6_early_dt) BP084_6_early_dt,
//       |min(BP084_6_dt_num) BP084_6_dt_num,
//       |min(BP095_month_nb) BP095_month_nb,
//       |min(BP095_df7_nb) BP095_df7_nb,
//       |min(BP095_df14_nb) BP095_df14_nb,
//       |min(BP095_df21_nb) BP095_df21_nb,
//       |min(BP095_df28_nb) BP095_df28_nb,
//       |min(BP095_early_dt) BP095_early_dt,
//       |min(BP095_dt_num) BP095_dt_num,
//       |min(BP121_month_nb) BP121_month_nb,
//       |min(BP121_df7_nb) BP121_df7_nb,
//       |min(BP121_df14_nb) BP121_df14_nb,
//       |min(BP121_df21_nb) BP121_df21_nb,
//       |min(BP121_df28_nb) BP121_df28_nb,
//       |min(BP121_early_dt) BP121_early_dt,
//       |min(BP121_dt_num) BP121_dt_num,
//       |min(BP202_month_nb) BP202_month_nb,
//       |min(BP202_df7_nb) BP202_df7_nb,
//       |min(BP202_df14_nb) BP202_df14_nb,
//       |min(BP202_df21_nb) BP202_df21_nb,
//       |min(BP202_df28_nb) BP202_df28_nb,
//       |min(BP202_early_dt) BP202_early_dt,
//       |min(BP202_dt_num) BP202_dt_num,
//       |min(BP154_2_month_nb) BP154_2_month_nb,
//       |min(BP154_2_df7_nb) BP154_2_df7_nb,
//       |min(BP154_2_df14_nb) BP154_2_df14_nb,
//       |min(BP154_2_df21_nb) BP154_2_df21_nb,
//       |min(BP154_2_df28_nb) BP154_2_df28_nb,
//       |min(BP154_2_early_dt) BP154_2_early_dt,
//       |min(BP154_2_dt_num) BP154_2_dt_num,
//       |min(BP163_month_nb) BP163_month_nb,
//       |min(BP163_df7_nb) BP163_df7_nb,
//       |min(BP163_df14_nb) BP163_df14_nb,
//       |min(BP163_df21_nb) BP163_df21_nb,
//       |min(BP163_df28_nb) BP163_df28_nb,
//       |min(BP163_early_dt) BP163_early_dt,
//       |min(BP163_dt_num) BP163_dt_num,
//       |min(BP107_month_nb) BP107_month_nb,
//       |min(BP107_df7_nb) BP107_df7_nb,
//       |min(BP107_df14_nb) BP107_df14_nb,
//       |min(BP107_df21_nb) BP107_df21_nb,
//       |min(BP107_df28_nb) BP107_df28_nb,
//       |min(BP107_early_dt) BP107_early_dt,
//       |min(BP107_dt_num) BP107_dt_num,
//       |min(BP196_3_month_nb) BP196_3_month_nb,
//       |min(BP196_3_df7_nb) BP196_3_df7_nb,
//       |min(BP196_3_df14_nb) BP196_3_df14_nb,
//       |min(BP196_3_df21_nb) BP196_3_df21_nb,
//       |min(BP196_3_df28_nb) BP196_3_df28_nb,
//       |min(BP196_3_early_dt) BP196_3_early_dt,
//       |min(BP196_3_dt_num) BP196_3_dt_num,
//       |min(BP198_month_nb) BP198_month_nb,
//       |min(BP198_df7_nb) BP198_df7_nb,
//       |min(BP198_df14_nb) BP198_df14_nb,
//       |min(BP198_df21_nb) BP198_df21_nb,
//       |min(BP198_df28_nb) BP198_df28_nb,
//       |min(BP198_early_dt) BP198_early_dt,
//       |min(BP198_dt_num) BP198_dt_num,
//       |min(BP172_month_nb) BP172_month_nb,
//       |min(BP172_df7_nb) BP172_df7_nb,
//       |min(BP172_df14_nb) BP172_df14_nb,
//       |min(BP172_df21_nb) BP172_df21_nb,
//       |min(BP172_df28_nb) BP172_df28_nb,
//       |min(BP172_early_dt) BP172_early_dt,
//       |min(BP172_dt_num) BP172_dt_num,
//       |min(BP143_month_nb) BP143_month_nb,
//       |min(BP143_df7_nb) BP143_df7_nb,
//       |min(BP143_df14_nb) BP143_df14_nb,
//       |min(BP143_df21_nb) BP143_df21_nb,
//       |min(BP143_df28_nb) BP143_df28_nb,
//       |min(BP143_early_dt) BP143_early_dt,
//       |min(BP143_dt_num) BP143_dt_num,
//       |min(BP037_month_nb) BP037_month_nb,
//       |min(BP037_df7_nb) BP037_df7_nb,
//       |min(BP037_df14_nb) BP037_df14_nb,
//       |min(BP037_df21_nb) BP037_df21_nb,
//       |min(BP037_df28_nb) BP037_df28_nb,
//       |min(BP037_early_dt) BP037_early_dt,
//       |min(BP037_dt_num) BP037_dt_num
//       |from vdm_fin.cwg_event_0401_day30_0612_new
//      """.stripMargin).first()
//    var min_map:Map[String,Float] = Map()
//    features.foreach(f=>min_map+=(f->min_data.getAs(f).toString.toDouble.formatted("%.3f").toFloat))
//
//    val min_string=min_map.map(f=>f._1+":"+f._2).toList.mkString(",")
//    val min_path = new Path("hdfs://nameservice1/user/chenweigen/min_info_30day_new.txt")
//
//    val min_fs = min_path.getFileSystem(conf)
//    if (min_fs.exists(min_path))
//      min_fs.delete(min_path, true)
//    val min_out_stream = new BufferedOutputStream(min_fs.create(min_path))
//    min_out_stream.write(min_string.getBytes("UTF-8"))
//    min_out_stream.flush()
//    min_out_stream.close()
//    min_fs.close()
    val max_map=sc.textFile("hdfs://nameservice1/user/chenweigen/max_info_30day_new.txt")
                .first().split(",").map(f=>{
             val kv=f.split(":")
             kv(0)->kv(1).toFloat
             }).toMap
    val min_map=sc.textFile("hdfs://nameservice1/user/chenweigen/min_info_30day_new.txt")
          .first().split(",").map(f=>{
          val kv=f.split(":")
          kv(0)->kv(1).toFloat
        }).toMap

    var str="select userid,if(y_bz=0,0,1) as y_bz,"
    features.foreach(f=>str=str+f+",")
    str=str.substring(0,str.length-1)+" from vdm_fin.cwg_event_0401_day30_0613_fix where reg_date is not null limit 100"
    val table_all=sql(str)
    val table_all_data=table_all.map(row=>{
      val row_feature=features.map(f=>
        if(max_map.get(f).getOrElse(0)==0 ||min_map.get(f).getOrElse(0)==max_map.get(f).getOrElse(0)) 0.0 else{
          (row.getAs(f).toString.toDouble.formatted("%.3f").toFloat-min_map.get(f).get)/(max_map.get(f).get-min_map.get(f).get)
        }
      )
      LabeledPoint(row.get(1).toString.toDouble, Vectors.dense(row_feature))
    }).toDF("label","features")

    val Array(trainingData, testData) = table_all_data.randomSplit(Array(0.8, 0.2))
    trainingData.cache()
    testData.cache()

//    val table_no_change=table_all.map(row=>{
//      val row_feature=features.map(f=>row.getAs(f).toString.toDouble.formatted("%.2f").toDouble)
//      LabeledPoint(row.get(1).toString.toDouble, Vectors.dense(row_feature))
//    }).toDF("label","features")
//
//    val Array(trainingData_raw, testData_raw) = table_no_change.randomSplit(Array(0.8, 0.2))

    val paramMap = List(
      "eta" -> 0.01f,
      "max_depth" -> args(2).toInt,
      "min_child_weight" -> args(3).toFloat,
//      "subsample" -> 1.0,
//      "colsample_bytree" -> 0.82,
//      "colsample_bylevel" -> 0.9,
//      "base_score" -> 0.005,
      "eval_metric" -> "auc",
//      "seed" -> 49,
      "silent" -> 1,
      "objective" -> "binary:logistic").toMap

    val xgboostModel = XGBoost.trainWithDataFrame(trainingData,paramMap, round = args(0).toInt, nWorkers = args(1).toInt,eval =null )
//    xgboostModel.saveModelAsHadoopFile("hdfs://nameservice1/user/chenweigen/xgb_model_30d_50.txt")(sc)
    xgboostModel.saveModelAsHadoopFile("hdfs://nameservice1/user/chenweigen/"+args(4))(sc)
    val train_prediction=xgboostModel.transform(trainingData).select("label","prediction")
//    train_prediction.show(10)
    val train_evaluator = new MulticlassClassificationEvaluator()
      .setLabelCol("label")
      .setPredictionCol("prediction")
      .setMetricName("accuracy")
    val train_accuracy = train_evaluator.evaluate(train_prediction)
    println("train_accuracy:"+train_accuracy)

    val scoreAndLabels = train_prediction.select(xgboostModel.getPredictionCol, xgboostModel.getLabelCol)
      .rdd
      .map{case Row(score:Double, label:Double) => (score, label)}
    val metric = new BinaryClassificationMetrics(scoreAndLabels)
    val auc = metric.areaUnderROC()
    println("train auc:" + auc)
//    metric.roc().take(metric.roc().count().toInt)
//
    val test_predictions=xgboostModel.transform(testData).select("label","prediction")
//    test_predictions.show(10)
    val test_evaluator = new MulticlassClassificationEvaluator()
      .setLabelCol("label")
      .setPredictionCol("prediction")
      .setMetricName("accuracy")
    val test_accuracy = test_evaluator.evaluate(test_predictions)
    println("test accuracy:"+test_accuracy)
    val test_scoreAndLabels = test_predictions.select(xgboostModel.getPredictionCol, xgboostModel.getLabelCol)
      .rdd
      .map{case Row(score:Double, label:Double) => (score, label)}
    val test_metric = new BinaryClassificationMetrics(test_scoreAndLabels)
    val test_auc = test_metric.areaUnderROC()
    println("test auc:" + test_auc)
////    val xgboost=XGBoost.loadModelFromHadoopFile("hdfs://nameservice1/user/chenweigen/xgb_model_200.txt")(sc)
    val scores=xgboostModel.booster.getFeatureScore()
    println("scores:"+scores.toList.map(f=>f._1+":"+f._2).mkString(","))
    sc.stop()
  }
}
